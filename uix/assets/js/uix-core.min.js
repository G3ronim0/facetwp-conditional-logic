var conduitApp={},coduitTemplates={},conduitRegisterApps,conduitModal,conduitModalSave,conduitGenID,conduitSaveObject,conduitGetData;!jQuery(function(a){var t=null;conduitException=function(a){this.message=a,this.name="ConduitException"},a.fn.conduitTrigger=function(t){var e={method:"GET",url:ajaxurl};return a.extend(!0,e,t),a.ajax(e).success(function(){}),this},a.fn.getObject=function(t){for(var e=a(this),i=e.find("[name]"),n={},o={},d=0;d<i.length;d++){var c=a(i[d]),r=c.prop("name").replace(/\]/gi,"").split("["),u=c.val(),p={};if((!t||!(r.indexOf("_id")>=0||r.indexOf("_node_point")>=0))&&(!c.is(":radio")&&!c.is(":checkbox")||c.is(":checked"))){if(c.prop("required")&&!c.val().length)throw c.focus(),new conduitException("requiredfield");for(var s=r.length-1;s>=0;s--){var l=r[s];if("undefined"==typeof l&&(l=""),0===l.length&&(p=[],"undefined"==typeof o[r[s-1]]?o[r[s-1]]=0:o[r[s-1]]+=1,l=o[r[s-1]]),s===r.length-1){if(u)if("true"===u)u=!0;else if("false"===u)u=!1;else if(isNaN(parseFloat(u))||parseFloat(u).toString()!==u){if("string"==typeof u&&("{"===u.substr(0,1)||"["===u.substr(0,1)))try{u=JSON.parse(u)}catch(f){}}else u=parseFloat(u);p[l]=u}else{var v=p;p={},p[l]=v}}a.extend(!0,n,p)}}return n},conduitGeneralBaldrick=function(){a(".wp-trigger").conduitTrigger({method:"POST",before:function(t){var e=a(t),i=e.closest("[data-app]");i.length?e.data("data",JSON.stringify(conduitBuildData(i.data("app")))):e.data("data")&&e.data("data",JSON.stringify(conduitBuildData(e.data("data"))))}})},conduitSaveObject=function(e){var i;i=!0===e?conduitPrepObject():conduitPrepObject(e);var n={action:uix.slug+"_save_config",uix_setup:a("#uix_setup").val(),page_slug:uix.page_slug,config:JSON.stringify(i),autosave:!0};uix.save_params&&(n.params=uix.save_params),a(window).trigger("uix.saving"),t&&t.abort(),t=a.post(ajaxurl,n,function(e){a(window).trigger("uix.saved"),t=null})},conduitPrepObject=function(){var a={};for(var t in conduitApp)conduitApp[t].app&&(conduitApp[t].app.is(":visible")?a[t]=conduitBuildData(t):a[t]=conduitApp[t].data),a[t]._tab&&delete a[t]._tab;return a},conduitModalFooter=function(t){var e,i=t.buttons?t.buttons.split(" "):["save"],n=t.modal.split("."),o=t.app?t.app:t.trigger.closest("[data-app]").data("app"),d={__node_path:n.join(".")},c="";d.__app=o,t.trigger.data("before")&&(d.__before=t.trigger.data("before")),t.trigger.data("callback")&&(d.__callback=t.trigger.data("callback"));for(var r=0;r<i.length;r++)c+=a("#__partial_"+i[r]).length?a("#__partial_"+i[r]).html():"";return(e=Handlebars.compile(c,{data:!0}))(d)},conduitModal=function(a,t){var e=a.modal.split("."),i=a.app?a.app:a.trigger.closest("[data-app]").data("app"),n=a["default"]?a["default"]:null,o=Handlebars.compile('<div data-app="'+a.template+'">{{> '+a.template+"}}</div>",{data:!0});if(data={},conduitBuildData(i),conduitApp[i]){var d=conduitApp[i].data;if(null!==n)data=n;else{for(var c=0;c<e.length;c++)d=d[e[c]]?d[e[c]]:{};data=d}}return data.__node_path=a.points,data.__app=i,conduitApp[a.template]={app:t.content,data:data},coduitTemplates[a.template]=o,o(data)},conduitGetData=function(a){var t=a.trigger.data("app"),e={};return conduitApp[t]&&conduitApp[t].data?conduitApp[t].data:e},conduitBuildData=function(a){if(conduitApp[a]&&conduitApp[a].app)try{conduitApp[a].data=conduitApp[a].app.getObject()}catch(t){return!1}return conduitApp[a].data._tab&&delete conduitApp[a].data._tab,conduitApp[a].data},conduitSyncData=function(a){conduitBuildData(a)},conduitRegisterApps=function(){var t=a("[data-app]").not("._bound_app");if(t.length&&(t.each(function(){var t=a(this),e=t.data("app");conduitApp[e]={app:t,data:uix.config[e]?uix.config[e]:{}},t.addClass("_bound_app"),conduitBuildUI(e)}),uix.tabs))for(var e in uix.tabs)if(uix.tabs[e]["default"]){a('[data-tab="'+e+'"]').trigger("click");break}},conduitBuildUI=function(t){if(conduitApp[t]){var e=conduitApp[t].data;e._tab={};for(var i in conduitApp)i!==t&&(e._tab[i]=conduitApp[i].data);conduitApp[t].app.html(coduitTemplates[t](e))}a(".uix-sortable").length&&a(".uix-sortable").each(function(){var t=a(this),e={forcePlaceholderSize:!0,placeholder:"uix-sortable-placeholder"};e=a.extend({},e,t.data()),a(this).sortable(e)}),a(window).trigger("uix.init"),a(window).trigger("modal.init")},conduitSetNode=function(t,e,i){for(var n=t.split("."),o='{ "'+n.join('": { "')+'" : '+JSON.stringify(i),d=0;d<n.length;d++)o+="}";var c=JSON.parse(o);a.extend(!0,conduitApp[e].data,c),conduitBuildUI(e)},conduitGenID=function(){var a=(new Date).getTime(),t="ndxxxxxxxx".replace(/[xy]/g,function(t){var e=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==t?e:3&e|8).toString(16)});return t},conduitAddNode=function(t,e,i){var n=conduitGenID(),o=t.data?t.data("addNode").split("."):t.split("."),d=i?i:t.data("nodeDefault"),c=o.join(".")+"."+n,r=JSON.parse('{ "_id" : "'+n+'", "_node_point" : "'+c+'" }');node_point_wrappers=a('[data-node-point="'+o.join(".")+'"]'),d&&"object"==typeof d&&a.extend(!0,r,d);for(var u='{ "'+o.join('": { "')+'" : { "'+n+'" : '+JSON.stringify(r),p=0;p<=o.length;p++)u+="}";var s=JSON.parse(u);conduitBuildData(e),a.extend(!0,conduitApp[e].data,s),node_point_wrappers.length&&node_point_wrappers.data("template")?node_point_wrappers.each(function(){var t=a(this),e=t.data("template");e&&coduitTemplates["__partial_"+e]&&t.append(coduitTemplates["__partial_"+e](r))}):conduitBuildUI(e)},a(document).on("keyup change",'[data-format="slug"]',function(t){var e=a(this);return e.data("master")&&e.prop("required")&&this.value.length<=0&&"change"===t.type?(this.value=a(e.data("master")).val().replace(/[^a-z0-9]/gi,"_").toLowerCase(),void(this.value.length&&e.trigger("change"))):void(this.value=this.value.replace(/[^a-z0-9]/gi,"_").toLowerCase())}),a(document).on("keyup change","[data-sync]",function(){var t=a(this),e=a(t.data("sync"));e.each(function(){var e=a(this);e.is("input")?e.val(t.val()).trigger("change"):e.text(t.val())})}),a(document).on("click","[data-add-node]",function(t){var e=a(this),i=e.closest("[data-app]").data("app");i&&"object"==typeof conduitApp[i]&&(t.preventDefault(),conduitAddNode(e,i))}),a(document).on("click","[data-remove-element]",function(t){var e=a(this),i=e.closest("[data-app]").data("app"),n=a(e.data("removeElement"));e.data("confirm")&&!confirm(e.data("confirm"))||(n.remove(),conduitSyncData(i))}),a(document).on("click","[data-save-object]",function(t){t.preventDefault();var e,i=a(this),n=a(this).data("saveObject"),o=a(".uix-save-spinner"),d=a(".uix-save-confirm");a(".uix-sub-nav");e=!0===n?conduitPrepObject():conduitPrepObject(n),i.addClass("saving"),d.hide(),o.css({visibility:"visible",opacity:1,display:"inline-block"});var c={action:uix.slug+"_save_config",uix_setup:a("#uix_setup").val(),page_slug:uix.page_slug,config:JSON.stringify(e)};uix.save_params&&(c.params=uix.save_params),a.post(ajaxurl,c,function(t){o.css({visibility:"",opacity:0,display:"none"}),d.fadeIn(),setTimeout(function(){d.fadeOut(800)},2e3),i.removeClass("saving"),a(window).trigger("uix.saved")})}),a(document).on("change","[data-live-sync]",function(t){var e=a(this).closest("[data-app]").data("app");conduitSyncData(e)}),a(document).on("click","button[data-live-sync]",function(t){var e=a(this).closest("[data-app]").data("app");conduitSyncData(e)}),a(document).on("click",".uix-notice .notice-dismiss",function(){var t=a(this).closest(".uix-notice");t.slideUp(200,function(){t.remove()})}),a(document).on("click","[data-tab]",function(t){t.preventDefault();var e=a(this),i=e.data("tab"),n=a(".active[data-tab]").data("tab");if(n){if(conduitBuildData(n),n===i)return;a('[data-app="'+n+'"]').empty().hide()}a("[data-tab]").removeClass("active"),a('[data-app="'+i+'"]').show(),e.addClass("active"),conduitBuildUI(i)}),a("script[data-template]").each(function(){var t=a(this),e=t.data("template");coduitTemplates[e]=Handlebars.compile(t.html(),{data:!0})}),a("script[data-handlebars-partial]").each(function(){var t=a(this);Handlebars.registerPartial(t.data("handlebarsPartial"),t.html()),coduitTemplates["__partial_"+t.data("handlebarsPartial")]=Handlebars.compile(t.html(),{data:!0})}),a(document).on("click","[data-modal-node]",function(t){var e,i=a(this),n=i.data("modal-node").split("."),o=i.data("app")?i.data("app"):n.shift(),d=i.data("type")?i.data("type"):"save";if(i.data("before")&&("function"==typeof i.data("before")?i.data("before")(i):"function"==typeof window[i.data("before")]&&window[i.data("before")](i)),"delete"!==d)try{e=i.closest(".uix-modal-wrap").getObject()}catch(t){return}if("add"===d)conduitAddNode(n.join("."),o,e);else if("delete"===d){var c=n.shift();n.length&&(c+="["+n.join("][")+"]"),a('[name^="'+c+'"]').remove(),conduitBuildData(o),conduitBuildUI(o)}else conduitSetNode(n.join("."),o,e);a(window).trigger("close.modal"),i.data("callback")&&("function"==typeof i.data("callback")?i.data("callback")(e,i):"function"==typeof window[i.data("callback")]&&window[i.data("callback")](e,i))}),a(window).on("close.modal",function(t){var e=a(".active[data-tab]").data("tab");e&&conduitBuildUI(e)}),a(document).on("change",".collapse-ruleset",function(){var t=a(this),e=t.data("ruleset"),i=t.closest(".uix-control-bar").find(".ruleset-toggle"),n=a(".ruleset-"+e);t.is(":checked")?(n.hide(),i.removeClass("dashicons-arrow-up").addClass("dashicons-arrow-down")):(n.show(),i.removeClass("dashicons-arrow-down").addClass("dashicons-arrow-up"))}),a(document).on("change",".condition-field-select",function(){var t=a(this),e=t.val(),i=t.parent().find(".condition-field-compare,.condition-field-value");"_basic_facets-empty"===e||"_basic_facets-not-empty"===e||"_basic_facets-not-empty"===e||"_template_"===e.substr(0,10)?i.hide():i.show()}),a(document).on("change",".action-thing-select",function(){var t=a(this),e=t.val(),i=t.parent().find(".selector-trigger"),n=t.parent().find(".selector-input");"_custom"!==e?(i.hide(),n.val("")):i.show()}),conduitRegisterApps(),window.onbeforeunload=function(){return t?!1:void 0}});